<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }
        .pass { color: #00ff00; }
        .fail { color: #ff0000; }
        .info { color: #ffff00; }
    </style>
</head>
<body>
    <h1>Calendar Debug Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        async function runTests() {
            log('=== Starting Calendar Debug Tests ===', 'info');

            // Test 1: Check if calendar.js exists
            log('Test 1: Checking if calendar.js is accessible...', 'info');
            try {
                const response = await fetch('js/calendar.js');
                if (response.ok) {
                    log('✓ calendar.js found (status: ' + response.status + ')', 'pass');
                } else {
                    log('✗ calendar.js returned status: ' + response.status, 'fail');
                }
            } catch (error) {
                log('✗ Error loading calendar.js: ' + error.message, 'fail');
            }

            // Test 2: Check if events.json exists and is valid
            log('Test 2: Checking if events.json is accessible...', 'info');
            try {
                const response = await fetch('data/events.json');
                if (response.ok) {
                    log('✓ events.json found (status: ' + response.status + ')', 'pass');
                    const data = await response.json();
                    log('✓ events.json is valid JSON', 'pass');
                    log('✓ Found ' + data.events.length + ' events', 'pass');

                    if (data.events.length > 0) {
                        log('✓ First event: ' + data.events[0].title, 'info');
                        log('✓ First event date: ' + data.events[0].date, 'info');
                        log('✓ First event type: ' + data.events[0].type, 'info');

                        // Check if all required fields exist
                        const requiredFields = ['id', 'title', 'date', 'type', 'location'];
                        const firstEvent = data.events[0];
                        const hasAllFields = requiredFields.every(field => field in firstEvent);

                        if (hasAllFields) {
                            log('✓ First event has all required fields', 'pass');
                        } else {
                            const missing = requiredFields.filter(field => !(field in firstEvent));
                            log('✗ First event missing fields: ' + missing.join(', '), 'fail');
                        }
                    } else {
                        log('✗ No events found in events.json!', 'fail');
                    }
                } else {
                    log('✗ events.json returned status: ' + response.status, 'fail');
                }
            } catch (error) {
                log('✗ Error loading events.json: ' + error.message, 'fail');
            }

            // Test 3: Check if required HTML elements exist
            log('Test 3: Checking if required HTML elements exist...', 'info');
            const requiredElements = ['calendarContainer', 'filters', 'monthYear'];
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log('✓ Element #' + id + ' exists', 'pass');
                } else {
                    log('✗ Element #' + id + ' NOT FOUND!', 'fail');
                }
            });

            // Test 4: Try to load events like calendar.js does
            log('Test 4: Simulating calendar.js event loading...', 'info');
            try {
                const response = await fetch('data/events.json');
                const data = await response.json();
                const events = data.events.map(e => {
                    const [year, month, day] = e.date.split('-').map(Number);
                    return {
                        ...e,
                        date: new Date(year, month - 1, day)
                    };
                });
                log('✓ Successfully parsed ' + events.length + ' events', 'pass');

                // Check if any events are valid dates
                const validDates = events.filter(e => e.date instanceof Date && !isNaN(e.date));
                log('✓ ' + validDates.length + ' events have valid dates', validDates.length === events.length ? 'pass' : 'fail');

            } catch (error) {
                log('✗ Error simulating event loading: ' + error.message, 'fail');
            }

            // Test 5: Check console for errors
            log('Test 5: Check browser console for errors', 'info');
            log('→ Open browser DevTools (F12) and check the Console tab for errors', 'info');

            log('=== Debug Tests Complete ===', 'info');
        }

        runTests();
    </script>
</body>
</html>
