name: atlantahamradio
region: atl  # ATL1 datacenter

# Static frontend site (existing)
static_sites:
  - name: atlantahamradio-frontend
    environment_slug: html
    source_dir: /
    error_document: 404.html

    github:                              # ← MUST be "github", not "git"
      repo: discerningowl/atlantahamradio   # ← short username/repo format
      branch: main
      deploy_on_push: true                 # ← this turns auto-deploy on

    routes:
      - path: /

    headers:
      - pattern: "**"
        headers:
          X-Frame-Options: "DENY"
          X-Content-Type-Options: "nosniff"
          Referrer-Policy: "strict-origin-when-cross-origin"
          Permissions-Policy: "geolocation=(), microphone=(), camera=()"
      - pattern: "**/*.html"
        headers:
          Cache-Control: "public, max-age=3600, must-revalidate"
      - pattern: "**/images/**"
        headers:
          Cache-Control: "public, max-age=31536000, immutable"
      - pattern: "**/*.css"
        headers:
          Cache-Control: "public, max-age=31536000, immutable"
      - pattern: "**/*.js"
        headers:
          Cache-Control: "public, max-age=31536000, immutable"

# Worker service for ICS-205 to CHIRP conversion
services:
  - name: ics205-parser-worker
    source_dir: /worker
    environment_slug: node-js
    instance_count: 1
    instance_size_slug: basic-xxs

    github:
      repo: discerningowl/atlantahamradio
      branch: main
      deploy_on_push: true

    envs:
      - key: GRADIENT_AI_API_KEY
        scope: RUN_TIME
        type: SECRET
      - key: GRADIENT_AI_WORKSPACE_ID
        scope: RUN_TIME
        type: SECRET
      - key: GRADIENT_AI_MODEL
        scope: RUN_TIME
        type: SECRET
      - key: PORT
        value: "8080"
      - key: NODE_ENV
        value: "production"

    http_port: 8080

    routes:
      - path: /api/ics205

    health_check:
      http_path: /health
      initial_delay_seconds: 30
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3

domains:
  - domain: atlantahamradio.org
    type: PRIMARY
    zone: atlantahamradio.org
  - domain: www.atlantahamradio.org
    type: ALIAS
    zone: atlantahamradio.org